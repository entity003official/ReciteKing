<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯æ±‡åŠ è½½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .log {
            background: #f8f8f8;
            padding: 10px;
            border-left: 4px solid #007cba;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error {
            border-left-color: #dc3545;
            background: #ffe6e6;
        }
        .success {
            border-left-color: #28a745;
            background: #e6ffe6;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a8b;
        }
    </style>
</head>
<body>
    <h1>è¯æ±‡æ•°æ®åŠ è½½æµ‹è¯•</h1>

    <div class="test-section">
        <h2>ğŸ“‚ æ–‡ä»¶è·¯å¾„æµ‹è¯•</h2>
        <button onclick="testPaths()">æµ‹è¯•æ–‡ä»¶è·¯å¾„</button>
        <div id="pathResults"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š è¯æ±‡ç®¡ç†å™¨æµ‹è¯•</h2>
        <button onclick="testVocabularyManager()">æµ‹è¯•è¯æ±‡ç®¡ç†å™¨</button>
        <div id="managerResults"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“– è¯¾ç¨‹æ•°æ®æµ‹è¯•</h2>
        <button onclick="testLessonData()">æµ‹è¯•ç¬¬ä¸€è¯¾æ•°æ®</button>
        <div id="lessonResults"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ” å®æ—¶æ—¥å¿—</h2>
        <div id="logs"></div>
    </div>

    <script src="vocabulary-manager.js"></script>
    <script>
        // é‡å®šå‘console.logåˆ°é¡µé¢
        const originalLog = console.log;
        const originalError = console.error;
        const logsDiv = document.getElementById('logs');

        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('INFO', args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('ERROR', args.join(' '));
        };

        function addLog(type, message) {
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type === 'ERROR' ? 'error' : ''}`;
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${type}: ${message}`;
            logsDiv.appendChild(logDiv);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        async function testPaths() {
            const pathResults = document.getElementById('pathResults');
            pathResults.innerHTML = '';

            const paths = [
                '../data/vocabulary/vocabulary_index.csv',
                'data/vocabulary/vocabulary_index.csv',
                '/data/vocabulary/vocabulary_index.csv',
                '../data/vocabulary/lesson_01_vocabulary.csv',
                'data/vocabulary/lesson_01_vocabulary.csv'
            ];

            for (const path of paths) {
                try {
                    const response = await fetch(path);
                    const div = document.createElement('div');
                    div.className = `log ${response.ok ? 'success' : 'error'}`;
                    div.textContent = `${path}: ${response.status} ${response.statusText}`;
                    pathResults.appendChild(div);
                } catch (error) {
                    const div = document.createElement('div');
                    div.className = 'log error';
                    div.textContent = `${path}: åŠ è½½å¤±è´¥ - ${error.message}`;
                    pathResults.appendChild(div);
                }
            }
        }

        async function testVocabularyManager() {
            const managerResults = document.getElementById('managerResults');
            managerResults.innerHTML = '';

            const div = document.createElement('div');
            div.className = 'log';

            if (window.vocabularyManager) {
                div.textContent = 'âœ… è¯æ±‡ç®¡ç†å™¨å·²åˆ›å»º';
                div.className += ' success';
                
                // æ˜¾ç¤ºåŠ è½½çš„è¯¾ç¨‹æ•°é‡
                setTimeout(() => {
                    const courseCount = window.vocabularyManager.categoryData.size;
                    const div2 = document.createElement('div');
                    div2.className = 'log success';
                    div2.textContent = `ğŸ“š å·²åŠ è½½è¯¾ç¨‹æ•°é‡: ${courseCount}`;
                    managerResults.appendChild(div2);

                    // æ˜¾ç¤ºè¯¾ç¨‹åˆ—è¡¨
                    if (courseCount > 0) {
                        const courses = Array.from(window.vocabularyManager.categoryData.keys());
                        const div3 = document.createElement('div');
                        div3.className = 'log';
                        div3.textContent = `è¯¾ç¨‹åˆ—è¡¨: ${courses.join(', ')}`;
                        managerResults.appendChild(div3);
                    }
                }, 1000);
            } else {
                div.textContent = 'âŒ è¯æ±‡ç®¡ç†å™¨æœªåˆ›å»º';
                div.className += ' error';
            }

            managerResults.appendChild(div);
        }

        async function testLessonData() {
            const lessonResults = document.getElementById('lessonResults');
            lessonResults.innerHTML = '';

            if (!window.vocabularyManager) {
                const div = document.createElement('div');
                div.className = 'log error';
                div.textContent = 'âŒ è¯æ±‡ç®¡ç†å™¨æœªå°±ç»ª';
                lessonResults.appendChild(div);
                return;
            }

            try {
                const words = await window.vocabularyManager.loadLessonVocabulary('ç¬¬ä¸€è¯¾');
                const div = document.createElement('div');
                div.className = 'log success';
                div.textContent = `âœ… ç¬¬ä¸€è¯¾åŠ è½½æˆåŠŸ: ${words.length} ä¸ªå•è¯`;
                lessonResults.appendChild(div);

                if (words.length > 0) {
                    const sampleDiv = document.createElement('div');
                    sampleDiv.className = 'log';
                    sampleDiv.textContent = `ç¤ºä¾‹å•è¯: ${JSON.stringify(words[0], null, 2)}`;
                    lessonResults.appendChild(sampleDiv);
                }
            } catch (error) {
                const div = document.createElement('div');
                div.className = 'log error';
                div.textContent = `âŒ ç¬¬ä¸€è¯¾åŠ è½½å¤±è´¥: ${error.message}`;
                lessonResults.appendChild(div);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
                testPaths();
                testVocabularyManager();
            }, 500);
        });
    </script>
</body>
</html>
