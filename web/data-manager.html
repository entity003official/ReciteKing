<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>数据管理 - 日语单词背诵王</title>
    <style>
        body { font-family: 'Segoe UI',sans-serif; background: #f7f7fb; margin: 0; }
        .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #0001; padding: 32px; }
        h1 { margin-bottom: 16px; }
        .lesson-block { border: 1px solid #eee; border-radius: 8px; margin-bottom: 24px; padding: 16px; }
        .lesson-title { font-size: 1.2em; margin-bottom: 8px; }
        .column-block { background: #f5f5fa; border-radius: 6px; margin-bottom: 12px; padding: 12px; }
        .column-title { font-weight: bold; }
        .word-list { margin: 8px 0 0 0; }
        .word-list input { width: 120px; margin-right: 8px; }
        .btn { background: #667eea; color: #fff; border: none; border-radius: 4px; padding: 6px 16px; cursor: pointer; margin-right: 8px;}
        .btn-del { background: #ff6b6b; }
        .btn-export { background: #ffd93d; color: #333; }
        .nav-header { background: #fff; border-bottom: 1px solid #eee; padding: 12px 0; margin-bottom: 24px; }
        .nav-links a { margin-right: 18px; text-decoration: none; color: #667eea; font-weight: bold; }
        .nav-links a.active { color: #ff6b6b; }
        @media (max-width: 600px) {
            .container { padding: 8px; }
            .lesson-block { padding: 8px; }
        }
    </style>
</head>
<body>
    <nav class="nav-header">
        <div class="nav-links">
            <a href="index.html">🏠 首页</a>
            <a href="word-typing.html">✏️ 单词输入</a>
            <a href="curriculum-selection.html">📚 课程练习</a>
            <a href="curriculum-stats.html">📊 课程统计</a>
            <a href="data-manager.html" class="active">🔧 数据管理</a>
        </div>
    </nav>
    <div class="container">
        <h1>数据管理（课程/栏目/单词）</h1>
        <div id="lessons"></div>
        <button class="btn" onclick="addLesson()">➕ 添加课程</button>
        <button class="btn" onclick="loadSampleData()">📋 加载示例数据</button>
        <button class="btn" onclick="loadAllLessons()">📚 加载全部课程</button>
        <button class="btn" onclick="loadCompleteBook()">📖 完整教材</button>
        <button class="btn btn-export" onclick="exportCSV()">📥 导出为CSV</button>
    </div>
    <script>
        // 数据结构：[{lesson:'第四课', columns:[{name:'星期', words:[{kana:'', kanji:'', meaning:''}, ...]}, ...]}, ...]
        let data = [];

        function render() {
            const lessonsDiv = document.getElementById('lessons');
            lessonsDiv.innerHTML = '';
            data.forEach((lesson, li) => {
                const lessonDiv = document.createElement('div');
                lessonDiv.className = 'lesson-block';
                lessonDiv.innerHTML = `
                    <div class="lesson-title">
                        课程：<input value="${lesson.lesson}" onchange="data[${li}].lesson=this.value;render()">
                        <button class="btn btn-del" onclick="delLesson(${li})">删除课程</button>
                        <button class="btn" onclick="addColumn(${li})">➕ 添加栏目</button>
                    </div>
                `;
                lesson.columns.forEach((col, ci) => {
                    const colDiv = document.createElement('div');
                    colDiv.className = 'column-block';
                    colDiv.innerHTML = `
                        <div class="column-title">
                            栏目：<input value="${col.name}" onchange="data[${li}].columns[${ci}].name=this.value;render()">
                            <button class="btn btn-del" onclick="delColumn(${li},${ci})">删除栏目</button>
                            <button class="btn" onclick="addWord(${li},${ci})">➕ 添加单词</button>
                            <button class="btn" onclick="batchAddWords(${li},${ci})">批量添加</button>
                        </div>
                        <div class="word-list" id="word-list-${li}-${ci}"></div>
                    `;
                    lessonDiv.appendChild(colDiv);
                    setTimeout(() => renderWords(li, ci), 0);
                });
                lessonsDiv.appendChild(lessonDiv);
            });
        }

        function renderWords(li, ci) {
            const wordDiv = document.getElementById(`word-list-${li}-${ci}`);
            wordDiv.innerHTML = '';
            data[li].columns[ci].words.forEach((w, wi) => {
                const row = document.createElement('div');
                row.innerHTML = `
                    假名: <input value="${w.kana}" onchange="data[${li}].columns[${ci}].words[${wi}].kana=this.value">
                    汉字: <input value="${w.kanji}" onchange="data[${li}].columns[${ci}].words[${wi}].kanji=this.value">
                    释义: <input value="${w.meaning}" onchange="data[${li}].columns[${ci}].words[${wi}].meaning=this.value">
                    词性: <select onchange="data[${li}].columns[${ci}].words[${wi}].pos=this.value">
                        <option value="名词" ${w.pos==='名词'?'selected':''}>名词</option>
                        <option value="动词" ${w.pos==='动词'?'selected':''}>动词</option>
                        <option value="形容词" ${w.pos==='形容词'?'selected':''}>形容词</option>
                        <option value="副词" ${w.pos==='副词'?'selected':''}>副词</option>
                        <option value="助词" ${w.pos==='助词'?'selected':''}>助词</option>
                        <option value="其他" ${w.pos==='其他'?'selected':''}>其他</option>
                    </select>
                    <button class="btn btn-del" onclick="delWord(${li},${ci},${wi})">删除</button>
                `;
                wordDiv.appendChild(row);
            });
        }

        function addLesson() {
            data.push({lesson:'新课程', columns:[]});
            render();
        }
        function delLesson(i) {
            if(confirm('确定删除该课程？')) { data.splice(i,1); render(); }
        }
        function addColumn(li) {
            data[li].columns.push({name:'新栏目', words:[]});
            render();
        }
        function delColumn(li,ci) {
            if(confirm('确定删除该栏目？')) { data[li].columns.splice(ci,1); render(); }
        }
        function addWord(li,ci) {
            data[li].columns[ci].words.push({kana:'', kanji:'', meaning:'', pos:'名词'});
            render();
        }
        function delWord(li,ci,wi) {
            data[li].columns[ci].words.splice(wi,1);
            render();
        }
        // 批量添加单词
        function batchAddWords(li,ci) {
            const text = prompt('每行格式：假名,汉字,释义,词性\n如：きのう,昨日,昨天,名词\n\n可以一次添加多行：');
            if(!text) return;
            text.split('\n').forEach(line => {
                line = line.trim();
                if(line) {
                    const arr = line.split(',');
                    if(arr.length >= 3) {
                        data[li].columns[ci].words.push({
                            kana: arr[0].trim(), 
                            kanji: arr[1].trim(), 
                            meaning: arr[2].trim(),
                            pos: arr[3] ? arr[3].trim() : '名词'
                        });
                    }
                }
            });
            render();
        }
        // 导出为CSV
        function exportCSV() {
            let csv = '课程,栏目,假名,汉字,释义,词性\n';
            data.forEach(lesson => {
                lesson.columns.forEach(col => {
                    col.words.forEach(w => {
                        csv += `"${lesson.lesson}","${col.name}","${w.kana}","${w.kanji}","${w.meaning}","${w.pos||'名词'}"\n`;
                    });
                });
            });
            const blob = new Blob([csv], {type:'text/csv'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'japanese_words_custom.csv';
            a.click();
        }
        
        // 加载示例数据
        function loadSampleData() {
            if(data.length > 0 && !confirm('这将覆盖现有数据，确定继续？')) return;
            
            data = [
                {
                    lesson: '第四课',
                    columns: [
                        {
                            name: '星期',
                            words: [
                                {kana: 'なんようび', kanji: '何曜日', meaning: '星期几', pos: '名词'},
                                {kana: 'げつようび', kanji: '月曜日', meaning: '星期一', pos: '名词'},
                                {kana: 'かようび', kanji: '火曜日', meaning: '星期二', pos: '名词'},
                                {kana: 'すいようび', kanji: '水曜日', meaning: '星期三', pos: '名词'},
                                {kana: 'もくようび', kanji: '木曜日', meaning: '星期四', pos: '名词'},
                                {kana: 'きんようび', kanji: '金曜日', meaning: '星期五', pos: '名词'},
                                {kana: 'どようび', kanji: '土曜日', meaning: '星期六', pos: '名词'},
                                {kana: 'にちようび', kanji: '日曜日', meaning: '星期日', pos: '名词'}
                            ]
                        },
                        {
                            name: '时间概念（天）',
                            words: [
                                {kana: 'きのう', kanji: '昨日', meaning: '昨天', pos: '名词'},
                                {kana: 'おととい', kanji: '一昨日', meaning: '前天', pos: '名词'},
                                {kana: 'きょう', kanji: '今日', meaning: '今天', pos: '名词'},
                                {kana: 'あした', kanji: '明日', meaning: '明天', pos: '名词'},
                                {kana: 'あさって', kanji: '明後日', meaning: '后天', pos: '名词'}
                            ]
                        },
                        {
                            name: '时间概念（一天内）',
                            words: [
                                {kana: 'ごぜん', kanji: '午前', meaning: '上午', pos: '名词'},
                                {kana: 'ごご', kanji: '午後', meaning: '下午', pos: '名词'},
                                {kana: 'あさ', kanji: '朝', meaning: '早晨', pos: '名词'},
                                {kana: 'ばん', kanji: '晩', meaning: '晚上', pos: '名词'},
                                {kana: 'ひる', kanji: '昼', meaning: '白天', pos: '名词'}
                            ]
                        },
                        {
                            name: '日常动作',
                            words: [
                                {kana: 'おきます', kanji: '起きます', meaning: '起床', pos: '动词'},
                                {kana: 'ねます', kanji: '寝ます', meaning: '睡觉', pos: '动词'},
                                {kana: 'たべます', kanji: '食べます', meaning: '吃', pos: '动词'},
                                {kana: 'のみます', kanji: '飲みます', meaning: '喝', pos: '动词'}
                            ]
                        },
                        {
                            name: '移动动作',
                            words: [
                                {kana: 'いきます', kanji: '行きます', meaning: '去', pos: '动词'},
                                {kana: 'きます', kanji: '来ます', meaning: '来', pos: '动词'},
                                {kana: 'かえります', kanji: '帰ります', meaning: '回来', pos: '动词'}
                            ]
                        },
                        {
                            name: '场所与物品',
                            words: [
                                {kana: 'がっこう', kanji: '学校', meaning: '学校', pos: '名词'},
                                {kana: 'いえ', kanji: '家', meaning: '家', pos: '名词'},
                                {kana: 'かいしゃ', kanji: '会社', meaning: '公司', pos: '名词'},
                                {kana: 'みず', kanji: '水', meaning: '水', pos: '名词'},
                                {kana: 'ごはん', kanji: 'ご飯', meaning: '米饭', pos: '名词'},
                                {kana: 'ほん', kanji: '本', meaning: '书', pos: '名词'},
                                {kana: 'でんしゃ', kanji: '電車', meaning: '电车', pos: '名词'}
                            ]
                        }
                    ]
                }
            ];
            render();
            alert('示例数据已加载！已添加词性字段，并重新整合了栏目分类');
        }
        
        // 加载全部课程数据
        function loadAllLessons() {
            if(data.length > 0 && !confirm('这将覆盖现有数据，确定继续？')) return;
            
            data = [
                // 第一课数据
                {
                    lesson: '第一课',
                    columns: [
                        {
                            name: '人称代词',
                            words: [
                                {kana: 'わたし', kanji: '私', meaning: '我', pos: '代词'},
                                {kana: 'あなた', kanji: 'あなた', meaning: '你', pos: '代词'},
                                {kana: 'あのひと', kanji: 'あの人', meaning: '那个人', pos: '代词'}
                            ]
                        },
                        {
                            name: '国籍与职业',
                            words: [
                                {kana: 'がくせい', kanji: '学生', meaning: '学生', pos: '名词'},
                                {kana: 'せんせい', kanji: '先生', meaning: '老师', pos: '名词'},
                                {kana: 'かいしゃいん', kanji: '会社員', meaning: '公司职员', pos: '名词'},
                                {kana: 'ちゅうごくじん', kanji: '中国人', meaning: '中国人', pos: '名词'},
                                {kana: 'にほんじん', kanji: '日本人', meaning: '日本人', pos: '名词'}
                            ]
                        }
                    ]
                },
                // 第四课数据(保留原有)
                {
                    lesson: '第四课',
                    columns: [
                        {
                            name: '星期',
                            words: [
                                {kana: 'なんようび', kanji: '何曜日', meaning: '星期几', pos: '名词'},
                                {kana: 'げつようび', kanji: '月曜日', meaning: '星期一', pos: '名词'},
                                {kana: 'かようび', kanji: '火曜日', meaning: '星期二', pos: '名词'},
                                {kana: 'すいようび', kanji: '水曜日', meaning: '星期三', pos: '名词'},
                                {kana: 'もくようび', kanji: '木曜日', meaning: '星期四', pos: '名词'},
                                {kana: 'きんようび', kanji: '金曜日', meaning: '星期五', pos: '名词'},
                                {kana: 'どようび', kanji: '土曜日', meaning: '星期六', pos: '名词'},
                                {kana: 'にちようび', kanji: '日曜日', meaning: '星期日', pos: '名词'}
                            ]
                        },
                        {
                            name: '时间概念（天）',
                            words: [
                                {kana: 'きのう', kanji: '昨日', meaning: '昨天', pos: '名词'},
                                {kana: 'おととい', kanji: '一昨日', meaning: '前天', pos: '名词'},
                                {kana: 'きょう', kanji: '今日', meaning: '今天', pos: '名词'},
                                {kana: 'あした', kanji: '明日', meaning: '明天', pos: '名词'},
                                {kana: 'あさって', kanji: '明後日', meaning: '后天', pos: '名词'}
                            ]
                        }
                    ]
                },
                // 第六课数据
                {
                    lesson: '第六课',
                    columns: [
                        {
                            name: '日常动作',
                            words: [
                                {kana: 'たべます', kanji: '食べます', meaning: '吃', pos: '动词'},
                                {kana: 'のみます', kanji: '飲みます', meaning: '喝', pos: '动词'},
                                {kana: 'みます', kanji: '見ます', meaning: '看', pos: '动词'},
                                {kana: 'ききます', kanji: '聞きます', meaning: '听', pos: '动词'}
                            ]
                        },
                        {
                            name: '食物饮料',
                            words: [
                                {kana: 'ごはん', kanji: 'ご飯', meaning: '米饭', pos: '名词'},
                                {kana: 'みず', kanji: '水', meaning: '水', pos: '名词'},
                                {kana: 'おちゃ', kanji: 'お茶', meaning: '茶', pos: '名词'},
                                {kana: 'コーヒー', kanji: 'コーヒー', meaning: '咖啡', pos: '名词'}
                            ]
                        }
                    ]
                }
            ];
            render();
            alert('全部课程数据已加载！包含第1、4、6课的精选词汇内容');
        }
        
        // 加载完整初级1教材数据
        function loadCompleteBook() {
            if(data.length > 0 && !confirm('这将加载完整的初级1教材数据，确定继续？')) return;
            
            alert('初级1教材包含24课，共780+个单词。数据较大，请稍等...');
            // 这里可以添加完整的24课数据
            // 由于数据量大，建议分批加载或从CSV文件读取
            alert('完整教材数据功能开发中，请使用CSV文件导入功能');
        }
        
        render();
    </script>
</body>
</html>
