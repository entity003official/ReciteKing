<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¾ç¨‹æ•°æ®åº“ç»Ÿè®¡ - æ—¥è¯­å•è¯èƒŒè¯µç‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-top: 100px;
        }

        /* å¯¼èˆªæ ·å¼ */
        .nav-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .nav-content {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-header h1 {
            color: white;
            margin: 0;
            font-size: 1.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .nav-links {
            display: flex;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.3rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .nav-links a {
            padding: 0.6rem 1rem;
            text-decoration: none;
            color: white;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .nav-links a.active {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: #333;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .nav-links a.active:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 768px) {
            .nav-header {
                padding: 1rem;
            }
            
            .nav-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-header h1 {
                font-size: 1.3rem;
            }
            
            .nav-links {
                width: 100%;
                justify-content: center;
            }
            
            .nav-links a {
                padding: 0.5rem 0.8rem;
                font-size: 0.8rem;
            }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .stat-card h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .lessons-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .table-header {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .table-header h2 {
            font-size: 1.5em;
        }

        .table-content {
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .curriculum-section {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            font-weight: bold;
        }

        .curriculum-section:hover {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
        }

        .navigation {
            text-align: center;
            margin-top: 30px;
        }

        .nav-button {
            display: inline-block;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            margin: 0 10px;
            transition: transform 0.3s ease;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .word-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .word-type-card {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9em;
        }

        .progress-bar {
            background: #ecf0f1;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            background: linear-gradient(135deg, #3498db, #2980b9);
            height: 100%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªå¤´éƒ¨ -->
    <nav class="nav-header">
        <div class="nav-content">
            <h1>ğŸŒ æ—¥è¯­å•è¯èƒŒè¯µç‹</h1>
            <div class="nav-links">
                <a href="index.html">ğŸ  é¦–é¡µ</a>
                <a href="word-typing.html">âœï¸ å•è¯è¾“å…¥</a>
                <a href="curriculum-selection.html">ğŸ“š è¯¾ç¨‹ç»ƒä¹ </a>
                <a href="curriculum-stats.html" class="active">ğŸ“Š è¯¾ç¨‹ç»Ÿè®¡</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1>ğŸ“š è¯¾ç¨‹æ•°æ®åº“ç»Ÿè®¡</h1>
            <p>æ—¥è¯­å­¦ä¹ è¯¾ç¨‹å†…å®¹æ¦‚è§ˆ</p>
        </div>

        <div id="loading" class="loading">
            æ­£åœ¨åŠ è½½è¯¾ç¨‹æ•°æ®...
        </div>

        <div id="content" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>æ€»å•è¯æ•°</h3>
                    <div class="number" id="totalWords">0</div>
                </div>
                <div class="stat-card">
                    <h3>è¯¾ç¨‹æ€»æ•°</h3>
                    <div class="number" id="totalCurricula">0</div>
                </div>
                <div class="stat-card">
                    <h3>è¯¾æ¬¡æ€»æ•°</h3>
                    <div class="number" id="totalLessons">0</div>
                </div>
                <div class="stat-card">
                    <h3>è¯æ€§ç§ç±»</h3>
                    <div class="number" id="totalWordTypes">0</div>
                </div>
            </div>

            <div class="word-types" id="wordTypes">
                <!-- è¯æ€§ç»Ÿè®¡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>

            <div class="lessons-table">
                <div class="table-header">
                    <h2>ğŸ“– è¯¾ç¨‹è¯¦ç»†ç»Ÿè®¡</h2>
                </div>
                <div class="table-content">
                    <table>
                        <thead>
                            <tr>
                                <th>è¯¾ç¨‹</th>
                                <th>è¯¾æ¬¡</th>
                                <th>å•è¯æ•°é‡</th>
                                <th>ä¸»è¦è¯æ€§</th>
                                <th>è¿›åº¦</th>
                            </tr>
                        </thead>
                        <tbody id="lessonsTableBody">
                            <!-- è¯¾ç¨‹æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="navigation">
            <a href="curriculum-selection.html" class="nav-button">ğŸ“‹ é€‰æ‹©è¯¾ç¨‹</a>
            <a href="word-typing.html" class="nav-button">âœï¸ å¼€å§‹ç»ƒä¹ </a>
            <a href="index.html" class="nav-button">ğŸ  è¿”å›é¦–é¡µ</a>
        </div>
    </div>

    <script>
        let allWords = [];
        let stats = {};

        // åŠ è½½å•è¯æ•°æ®
        async function loadWords() {
            try {
                // å…ˆå°è¯•åŠ è½½æ‰©å±•ç‰ˆæœ¬
                const response = await fetch('japanese_words_curriculum_extended.csv');
                const text = await response.text();
                const lines = text.trim().split('\n');
                const headers = lines[0].split(',');
                
                allWords = lines.slice(1).map(line => {
                    const values = line.split(',');
                    const word = {};
                    headers.forEach((header, index) => {
                        word[header] = values[index] || '';
                    });
                    return word;
                });
                
                console.log('Loaded words from extended database:', allWords.length);
                calculateStats();
                renderStats();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (error) {
                console.log('æ‰©å±•æ•°æ®åº“ä¸å¯ç”¨ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®åº“');
                try {
                    const response = await fetch('japanese_words_curriculum.csv');
                    const text = await response.text();
                    const lines = text.trim().split('\n');
                    const headers = lines[0].split(',');
                    
                    allWords = lines.slice(1).map(line => {
                        const values = line.split(',');
                        const word = {};
                        headers.forEach((header, index) => {
                            word[header] = values[index] || '';
                        });
                        return word;
                    });
                    
                    console.log('Loaded words from default database:', allWords.length);
                    calculateStats();
                    renderStats();
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').style.display = 'block';
                } catch (fallbackError) {
                    console.error('æ— æ³•åŠ è½½è¯¾ç¨‹æ•°æ®:', fallbackError);
                    document.getElementById('loading').innerHTML = 
                        '<div class="error">æ— æ³•åŠ è½½è¯¾ç¨‹æ•°æ®ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</div>';
                }
            }
        }

        // è®¡ç®—ç»Ÿè®¡æ•°æ®
        function calculateStats() {
            stats = {
                totalWords: allWords.length,
                curricula: {},
                wordTypes: {},
                lessons: {}
            };

            allWords.forEach(word => {
                const curriculum = word.è¯¾ç¨‹;
                const lesson = word.è¯¾æ¬¡;
                const wordType = word.è¯æ€§;

                // ç»Ÿè®¡è¯¾ç¨‹
                if (!stats.curricula[curriculum]) {
                    stats.curricula[curriculum] = {
                        lessons: new Set(),
                        words: 0
                    };
                }
                stats.curricula[curriculum].lessons.add(lesson);
                stats.curricula[curriculum].words++;

                // ç»Ÿè®¡è¯æ€§
                if (!stats.wordTypes[wordType]) {
                    stats.wordTypes[wordType] = 0;
                }
                stats.wordTypes[wordType]++;

                // ç»Ÿè®¡è¯¾æ¬¡
                const lessonKey = `${curriculum}-${lesson}`;
                if (!stats.lessons[lessonKey]) {
                    stats.lessons[lessonKey] = {
                        curriculum,
                        lesson,
                        words: 0,
                        wordTypes: new Set()
                    };
                }
                stats.lessons[lessonKey].words++;
                stats.lessons[lessonKey].wordTypes.add(wordType);
            });

            // è½¬æ¢Setä¸ºæ•°ç»„é•¿åº¦
            Object.keys(stats.curricula).forEach(curriculum => {
                stats.curricula[curriculum].lessons = stats.curricula[curriculum].lessons.size;
            });
        }

        // æ¸²æŸ“ç»Ÿè®¡æ•°æ®
        function renderStats() {
            // åŸºæœ¬ç»Ÿè®¡
            document.getElementById('totalWords').textContent = stats.totalWords;
            document.getElementById('totalCurricula').textContent = Object.keys(stats.curricula).length;
            document.getElementById('totalLessons').textContent = Object.keys(stats.lessons).length;
            document.getElementById('totalWordTypes').textContent = Object.keys(stats.wordTypes).length;

            // è¯æ€§ç»Ÿè®¡
            const wordTypesContainer = document.getElementById('wordTypes');
            const sortedWordTypes = Object.entries(stats.wordTypes)
                .sort((a, b) => b[1] - a[1]);
            
            wordTypesContainer.innerHTML = sortedWordTypes.map(([type, count]) => `
                <div class="word-type-card">
                    <strong>${type}</strong><br>
                    ${count} ä¸ªè¯
                </div>
            `).join('');

            // è¯¾ç¨‹è¯¦ç»†è¡¨æ ¼
            const tableBody = document.getElementById('lessonsTableBody');
            const sortedLessons = Object.entries(stats.lessons)
                .sort((a, b) => {
                    const [curriculumA, lessonA] = a[0].split('-');
                    const [curriculumB, lessonB] = b[0].split('-');
                    if (curriculumA !== curriculumB) {
                        return curriculumA.localeCompare(curriculumB);
                    }
                    return lessonA.localeCompare(lessonB);
                });

            let currentCurriculum = '';
            const maxWordsPerLesson = Math.max(...Object.values(stats.lessons).map(l => l.words));

            tableBody.innerHTML = sortedLessons.map(([key, lesson]) => {
                const isNewCurriculum = lesson.curriculum !== currentCurriculum;
                if (isNewCurriculum) {
                    currentCurriculum = lesson.curriculum;
                }

                const progressPercentage = (lesson.words / maxWordsPerLesson) * 100;
                const mainWordTypes = Array.from(lesson.wordTypes).slice(0, 3).join(', ');

                return `
                    <tr ${isNewCurriculum ? 'class="curriculum-section"' : ''}>
                        <td>${isNewCurriculum ? lesson.curriculum : ''}</td>
                        <td>${lesson.lesson}</td>
                        <td>
                            <strong>${lesson.words}</strong>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                            </div>
                        </td>
                        <td>${mainWordTypes}</td>
                        <td>${Math.round(progressPercentage)}%</td>
                    </tr>
                `;
            }).join('');
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', loadWords);
    </script>
</body>
</html>
