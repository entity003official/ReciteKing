<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日语单词课程选择</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 1000px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .curriculum-selector {
            margin-bottom: 30px;
        }

        .curriculum-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            gap: 8px;
        }

        .curriculum-tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            white-space: nowrap;
            transition: all 0.3s ease;
            min-width: fit-content;
        }

        .curriculum-tab.active {
            background: #4f46e5;
            color: white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .lesson-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .lesson-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
            border-color: #4f46e5;
        }

        .lesson-card.selected {
            background: #4f46e5;
            color: white;
            border-color: #4338ca;
        }

        .lesson-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .lesson-info {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 12px;
        }

        .word-count {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            display: inline-block;
        }

        .lesson-card:not(.selected) .word-count {
            background: #e9ecef;
            color: #666;
        }

        .control-panel {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
        }

        .control-label {
            font-weight: 600;
            color: #333;
            white-space: nowrap;
        }

        .select-all-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .select-all-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .clear-btn {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: #d97706;
            transform: translateY(-1px);
        }

        .selected-count {
            background: #4f46e5;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .start-practice {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .start-practice:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(102, 126, 234, 0.4);
        }

        .start-practice:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .word-preview {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 16px;
            max-height: 300px;
            overflow-y: auto;
        }

        .preview-title {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }

        .word-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 8px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9em;
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .word-kana {
            font-weight: 600;
            color: #4f46e5;
            min-width: 80px;
        }

        .word-kanji {
            color: #333;
            min-width: 60px;
        }

        .word-meaning {
            color: #666;
            flex: 1;
        }

        .back-to-selection {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            color: #4f46e5;
            transition: all 0.3s ease;
        }

        .back-to-selection:hover {
            background: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .lessons-grid {
                grid-template-columns: 1fr;
            }

            .control-row {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group {
                min-width: auto;
            }

            .curriculum-tabs {
                flex-direction: column;
                gap: 4px;
            }

            .back-to-selection {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 20px;
            }
            
            .nav-header {
                padding: 1rem;
            }
            
            .nav-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-header h1 {
                font-size: 1.3rem;
            }
            
            .nav-links {
                width: 100%;
                justify-content: center;
            }
            
            .nav-links a {
                padding: 0.5rem 0.8rem;
                font-size: 0.8rem;
            }
        }

        /* 导航样式 */
        .nav-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .nav-content {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-header h1 {
            color: white;
            margin: 0;
            font-size: 1.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .nav-links {
            display: flex;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.3rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .nav-links a {
            padding: 0.6rem 1rem;
            text-decoration: none;
            color: white;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .nav-links a.active {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: #333;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .nav-links a.active:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        body {
            padding-top: 80px;
        }
    </style>
</head>
<body>
    <!-- 导航头部 -->
    <nav class="nav-header">
        <div class="nav-content">
            <h1>🎌 日语单词背诵王</h1>
            <div class="nav-links">
                <a href="index.html">🏠 首页</a>
                <a href="word-typing.html">✏️ 单词输入</a>
                <a href="curriculum-selection.html" class="active">📚 课程练习</a>
                <a href="curriculum-stats.html">📊 课程统计</a>
            </div>
        </div>
    </nav>

    <button class="back-to-selection" onclick="goToWordTyping()" style="display: none;" id="backBtn">
        ← 返回练习
    </button>

    <div class="container">
        <div class="header">
            <h1>📚 日语单词课程练习</h1>
            <p>选择你想要练习的课程，开始系统化的日语学习之旅</p>
        </div>

        <div class="curriculum-selector">
            <div class="curriculum-tabs">
                <button class="curriculum-tab active" data-curriculum="初级上册">初级上册</button>
                <button class="curriculum-tab" data-curriculum="初级下册">初级下册</button>
                <button class="curriculum-tab" data-curriculum="中级上册">中级上册</button>
                <button class="curriculum-tab" data-curriculum="中级下册">中级下册</button>
            </div>
        </div>

        <div class="control-panel">
            <div class="control-row">
                <div class="control-group">
                    <span class="control-label">快速选择：</span>
                    <button class="select-all-btn" onclick="selectAllLessons()">全选当前册</button>
                    <button class="clear-btn" onclick="clearSelection()">清除选择</button>
                </div>
                <div class="control-group">
                    <span class="control-label">已选课程：</span>
                    <span class="selected-count" id="selectedCount">0 课</span>
                </div>
            </div>
            <div class="control-row">
                <div class="control-group">
                    <span class="control-label">预计单词数：</span>
                    <span class="selected-count" id="wordCount">0 个</span>
                </div>
                <div class="control-group">
                    <span class="control-label">练习时间：</span>
                    <span class="selected-count" id="estimatedTime">0 分钟</span>
                </div>
            </div>
        </div>

        <div class="lessons-grid" id="lessonsGrid">
            <!-- 课程卡片将通过 JavaScript 动态生成 -->
        </div>

        <div class="word-preview" id="wordPreview" style="display: none;">
            <div class="preview-title">选中单词预览</div>
            <div id="wordList"></div>
        </div>

        <button class="start-practice" id="startBtn" onclick="startPractice()" disabled>
            开始练习 (0 个单词)
        </button>
    </div>

    <script>
        // 课程数据结构
        const curriculumData = {
            '初级上册': {
                '第1课': { words: 8, topics: '自我介绍、问候' },
                '第2课': { words: 8, topics: '指示代词、物品' },
                '第3课': { words: 8, topics: '场所、方向' },
                '第4课': { words: 8, topics: '时间表达' },
                '第5课': { words: 8, topics: '动词基础、去来' },
                '第6课': { words: 8, topics: '饮食动词' },
                '第7课': { words: 8, topics: '授受表现' },
                '第8课': { words: 8, topics: '颜色形容词' },
                '第9课': { words: 8, topics: '喜好表达' },
                '第10课': { words: 8, topics: '存在表现' }
            },
            '初级下册': {
                '第11课': { words: 10, topics: '家族、人物' },
                '第12课': { words: 10, topics: '购物、价格' },
                '第13课': { words: 10, topics: '交通工具' },
                '第14课': { words: 10, topics: '天气、季节' },
                '第15课': { words: 10, topics: '动词过去式' },
                '第16课': { words: 10, topics: '形容词活用' },
                '第17课': { words: 10, topics: '比较表现' },
                '第18课': { words: 10, topics: '意向表现' },
                '第19课': { words: 10, topics: '经验表现' },
                '第20课': { words: 10, topics: '敬语入门' }
            },
            '中级上册': {
                '第21课': { words: 12, topics: '条件表现' },
                '第22课': { words: 12, topics: '可能表现' },
                '第23课': { words: 12, topics: '被动表现' },
                '第24课': { words: 12, topics: '使役表现' },
                '第25课': { words: 12, topics: '敬语应用' }
            },
            '中级下册': {
                '第26课': { words: 15, topics: '复合动词' },
                '第27课': { words: 15, topics: '抽象概念' },
                '第28课': { words: 15, topics: '商务用语' },
                '第29课': { words: 15, topics: '文学表现' },
                '第30课': { words: 15, topics: '综合应用' }
            }
        };

        let selectedLessons = new Set();
        let currentCurriculum = '初级上册';
        let allWords = [];

        // 加载单词数据
        async function loadWords() {
            try {
                // 先尝试加载扩展版本
                const response = await fetch('japanese_words_curriculum_extended.csv');
                const text = await response.text();
                const lines = text.trim().split('\n');
                const headers = lines[0].split(',');
                
                allWords = lines.slice(1).map(line => {
                    const values = line.split(',');
                    const word = {};
                    headers.forEach((header, index) => {
                        word[header] = values[index] || '';
                    });
                    return word;
                });
                
                console.log('Loaded words from extended database:', allWords.length);
                renderLessons();
            } catch (error) {
                console.log('扩展数据库不可用，使用默认数据库');
                try {
                    const response = await fetch('japanese_words_curriculum.csv');
                    const text = await response.text();
                    const lines = text.trim().split('\n');
                    const headers = lines[0].split(',');
                    
                    allWords = lines.slice(1).map(line => {
                        const values = line.split(',');
                        const word = {};
                        headers.forEach((header, index) => {
                            word[header] = values[index] || '';
                        });
                        return word;
                    });
                    
                    console.log('Loaded words from default database:', allWords.length);
                    renderLessons();
                } catch (fallbackError) {
                    console.error('无法加载课程数据:', fallbackError);
                    alert('无法加载课程数据，请检查文件是否存在');
                }
            }
        }

        // 生成示例数据作为备用
        function generateSampleWords() {
            const sampleWords = [];
            Object.keys(curriculumData).forEach(curriculum => {
                Object.keys(curriculumData[curriculum]).forEach(lesson => {
                    const wordCount = curriculumData[curriculum][lesson].words;
                    for (let i = 1; i <= wordCount; i++) {
                        sampleWords.push({
                            '课程': curriculum,
                            '课次': lesson,
                            '假名': `かな${i}`,
                            '汉字': `漢字${i}`,
                            '释义': `意思${i}`,
                            '词性': '名词',
                            '罗马字': `kana${i}`
                        });
                    }
                });
            });
            return sampleWords;
        }

        // 渲染课程列表
        function renderLessons() {
            const grid = document.getElementById('lessonsGrid');
            const lessons = curriculumData[currentCurriculum];
            
            grid.innerHTML = '';
            
            Object.keys(lessons).forEach(lessonName => {
                const lesson = lessons[lessonName];
                const actualWordCount = getActualWordCount(currentCurriculum, lessonName);
                
                const card = document.createElement('div');
                card.className = 'lesson-card';
                card.dataset.lesson = lessonName;
                
                if (selectedLessons.has(`${currentCurriculum}-${lessonName}`)) {
                    card.classList.add('selected');
                }
                
                card.innerHTML = `
                    <div class="lesson-title">${lessonName}</div>
                    <div class="lesson-info">${lesson.topics}</div>
                    <div class="word-count">${actualWordCount} 个单词</div>
                `;
                
                card.addEventListener('click', () => toggleLessonSelection(currentCurriculum, lessonName, card));
                grid.appendChild(card);
            });
        }

        // 获取实际单词数量
        function getActualWordCount(curriculum, lesson) {
            return allWords.filter(word => word['课程'] === curriculum && word['课次'] === lesson).length;
        }

        // 切换课程选择
        function toggleLessonSelection(curriculum, lesson, cardElement) {
            const key = `${curriculum}-${lesson}`;
            
            if (selectedLessons.has(key)) {
                selectedLessons.delete(key);
                cardElement.classList.remove('selected');
            } else {
                selectedLessons.add(key);
                cardElement.classList.add('selected');
            }
            
            updateSelectionInfo();
            updateWordPreview();
        }

        // 更新选择信息
        function updateSelectionInfo() {
            const selectedCount = selectedLessons.size;
            const totalWords = getTotalSelectedWords();
            const estimatedMinutes = Math.ceil(totalWords * 0.5); // 假设每个单词30秒
            
            document.getElementById('selectedCount').textContent = `${selectedCount} 课`;
            document.getElementById('wordCount').textContent = `${totalWords} 个`;
            document.getElementById('estimatedTime').textContent = `${estimatedMinutes} 分钟`;
            
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = selectedCount === 0;
            startBtn.textContent = `开始练习 (${totalWords} 个单词)`;
        }

        // 获取选中的总单词数
        function getTotalSelectedWords() {
            let total = 0;
            selectedLessons.forEach(key => {
                const [curriculum, lesson] = key.split('-');
                total += getActualWordCount(curriculum, lesson);
            });
            return total;
        }

        // 更新单词预览
        function updateWordPreview() {
            const preview = document.getElementById('wordPreview');
            const wordList = document.getElementById('wordList');
            
            if (selectedLessons.size === 0) {
                preview.style.display = 'none';
                return;
            }
            
            const selectedWords = getSelectedWords();
            preview.style.display = 'block';
            
            wordList.innerHTML = selectedWords.slice(0, 10).map(word => `
                <div class="word-item">
                    <span class="word-kana">${word['假名']}</span>
                    <span class="word-kanji">${word['汉字']}</span>
                    <span class="word-meaning">${word['释义']}</span>
                </div>
            `).join('');
            
            if (selectedWords.length > 10) {
                wordList.innerHTML += `
                    <div class="word-item" style="font-style: italic; color: #888;">
                        <span>... 还有 ${selectedWords.length - 10} 个单词</span>
                    </div>
                `;
            }
        }

        // 获取选中的单词
        function getSelectedWords() {
            const words = [];
            selectedLessons.forEach(key => {
                const [curriculum, lesson] = key.split('-');
                const lessonWords = allWords.filter(word => 
                    word['课程'] === curriculum && word['课次'] === lesson
                );
                words.push(...lessonWords);
            });
            return words;
        }

        // 全选当前册
        function selectAllLessons() {
            const lessons = curriculumData[currentCurriculum];
            Object.keys(lessons).forEach(lesson => {
                selectedLessons.add(`${currentCurriculum}-${lesson}`);
            });
            renderLessons();
            updateSelectionInfo();
            updateWordPreview();
        }

        // 清除选择
        function clearSelection() {
            selectedLessons.clear();
            renderLessons();
            updateSelectionInfo();
            updateWordPreview();
        }

        // 开始练习
        function startPractice() {
            if (selectedLessons.size === 0) {
                alert('请先选择要练习的课程！');
                return;
            }
            
            const selectedWords = getSelectedWords();
            
            // 将选中的单词存储到 localStorage
            localStorage.setItem('practiceWords', JSON.stringify(selectedWords));
            localStorage.setItem('practiceType', 'curriculum');
            
            // 跳转到练习页面
            window.location.href = 'word-typing.html';
        }

        // 返回单词练习页面（当从练习页面返回时使用）
        function goToWordTyping() {
            window.location.href = 'word-typing.html';
        }

        // 检查是否是从练习页面返回
        function checkReturnFromPractice() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('from') === 'practice') {
                document.getElementById('backBtn').style.display = 'block';
            }
        }

        // 课程标签切换
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.curriculum-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // 更新活动标签
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 切换课程
                    currentCurriculum = this.dataset.curriculum;
                    selectedLessons.clear(); // 切换时清除选择
                    renderLessons();
                    updateSelectionInfo();
                    updateWordPreview();
                });
            });
            
            // 加载数据
            loadWords();
            checkReturnFromPractice();
        });
    </script>
</body>
</html>
